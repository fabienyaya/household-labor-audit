<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家务审计系统</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel 用于浏览器内编译 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 简单的淡入动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-in {
            animation: fadeIn 0.2s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 图标组件 (SVG) ---
        const IconBase = ({ d, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{d}</svg>
        );

        const Wallet = (p) => <IconBase d={<><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4" /><path d="M3 5v14a2 2 0 0 0 2 2h16v-5" /><path d="M18 12a2 2 0 0 0 0 4h4v-4Z" /></>} {...p} />;
        const Sparkles = (p) => <IconBase d={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M9 3v4" /><path d="M3 5h4" /><path d="M3 9h4" /></>} {...p} />;
        const ChefHat = (p) => <IconBase d={<><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z" /><line x1="6" y1="17" x2="18" y2="17" /></>} {...p} />;
        const Baby = (p) => <IconBase d={<><path d="M9 12h.01" /><path d="M15 12h.01" /><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5" /><path d="M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1" /></>} {...p} />;
        const SprayCan = (p) => <IconBase d={<><path d="M3 3h.01" /><path d="M7 5h.01" /><path d="M11 7h.01" /><path d="M3 7h.01" /><path d="M7 9h.01" /><path d="M3 11h.01" /><rect width="4" height="4" x="15" y="5" rx="1" /><path d="m19 9 2 2v10c0 .6-.4 1-1 1h-6c-.6 0-1-.4-1-1v-6.6c0-.52.2-1.02.57-1.38L16 9.6" /></>} {...p} />;
        const HeartHandshake = (p) => <IconBase d={<><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /><path d="M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08v0c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.15-.49 2.87 2.87 0 0 1 1.08 3.08" /></>} {...p} />;
        const FileText = (p) => <IconBase d={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><line x1="10" y1="9" x2="8" y2="9" /></>} {...p} />;
        const Share2 = (p) => <IconBase d={<><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" /><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" /></>} {...p} />;
        const TrendingUp = (p) => <IconBase d={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>} {...p} />;
        const History = (p) => <IconBase d={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></>} {...p} />;
        const X = (p) => <IconBase d={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} {...p} />;
        const Plus = (p) => <IconBase d={<><path d="M5 12h14" /><path d="M12 5v14" /></>} {...p} />;

        // --- 应用配置 ---
        const MARKET_RATES = {
            cleaning: { rate: 60, label: "家庭保洁", icon: SprayCan, color: "bg-sky-100 text-sky-600" },
            cooking: { rate: 80, label: "营养膳食", icon: ChefHat, color: "bg-orange-100 text-orange-600" },
            childcare: { rate: 150, label: "育儿辅导", icon: Baby, color: "bg-rose-100 text-rose-600" },
            emotion: { rate: 300, label: "情绪价值", icon: HeartHandshake, color: "bg-purple-100 text-purple-600" },
            admin: { rate: 100, label: "家庭统筹", icon: FileText, color: "bg-indigo-100 text-indigo-600" },
        };

        // 按类别定制的情绪价值文案库
        const CATEGORY_PRAISE = {
            cleaning: [
                "扫除的不仅是尘埃，更是生活的烦恼。您让这个家重焕光彩，这份洁净带来的舒适感，是最高级的治愈。",
                "看似重复的擦拭，实则是对生活品质的坚持。地板上的光亮映射着您对家的热爱，感谢您守护了我们的舒适圈。"
            ],
            cooking: [
                "厨房的烟火气，是这个家最温暖的底色。您投入的不仅是食材，更是对家人的关爱，每一口都是幸福的味道。",
                "比起外卖的便捷，您做的饭菜里藏着无价的心意。感谢您用美味滋养了全家人的胃和心，这是最顶级的营养师服务。"
            ],
            childcare: [
                "在育儿上的每一份耐心，都是给孩子未来的储蓄。您不仅仅是陪伴，更是在小心翼翼地呵护一颗幼小的心灵。",
                "数据无法计算您付出的心力。您用温柔编织了孩子的安全感，这是金钱买不到的成长礼物，您是孩子心中最好的榜样。"
            ],
            emotion: [
                "您是家庭的隐形支柱。在家人疲惫时提供的倾听与支持，是维系家庭稳固的最强粘合剂，这份温柔价值连城。",
                "情绪价值是奢侈品，而您慷慨地将其给予了这个家。感谢您如定海神针般的存在，安抚了所有的焦虑与不安。"
            ],
            admin: [
                "您是家庭的幕后CEO。琐碎的统筹规划，保证了生活的有序运转，您的智慧让这个家井井有条，高效又温馨。",
                "看似平淡的日常，全靠您的精心调度。感谢您承担了最耗费心力的管理工作，让家人得以享受无忧的生活。"
            ],
            default: [
                "您是这个家不可或缺的合伙人。每一分钟的付出，都化作了家庭的温暖与安稳。辛苦了，您的爱值得被看见。",
                "经审计，您的付出极大地提升了家庭幸福指数。无论是体力还是心力，您都做到了极致，请务必为自己感到骄傲。"
            ]
        };

        // --- 主组件 ---
        function FamilyLaborAudit() {
            const [totalAsset, setTotalAsset] = useState(0);
            const [totalHours, setTotalHours] = useState(0);
            const [records, setRecords] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState('cleaning');
            const [duration, setDuration] = useState(60);
            const [showReport, setShowReport] = useState(false);
            const [reportContent, setReportContent] = useState(null);
            const [isAnimating, setIsAnimating] = useState(false);

            useEffect(() => {
                const savedRecords = [
                    { id: 1, category: 'cooking', duration: 45, value: 60, date: new Date(Date.now() - 86400000).toISOString() },
                    { id: 2, category: 'cleaning', duration: 60, value: 60, date: new Date(Date.now() - 172800000).toISOString() },
                ];
                setRecords(savedRecords);
                recalculateTotals(savedRecords);
            }, []);

            const recalculateTotals = (currentRecords) => {
                const value = currentRecords.reduce((acc, curr) => acc + curr.value, 0);
                const time = currentRecords.reduce((acc, curr) => acc + curr.duration, 0);
                setTotalAsset(value);
                setTotalHours(time / 60);
            };

            const handleAddRecord = () => {
                const rate = MARKET_RATES[selectedCategory].rate;
                const value = (rate * (duration / 60));

                const newRecord = {
                    id: Date.now(),
                    category: selectedCategory,
                    duration: duration,
                    value: value,
                    date: new Date().toISOString()
                };

                const newRecords = [newRecord, ...records];
                setRecords(newRecords);
                recalculateTotals(newRecords);

                setIsAnimating(true);
                setTimeout(() => setIsAnimating(false), 500);
            };

            const generateReport = () => {
                // 1. 找出价值贡献最高的类别
                let topCategory = 'default';
                if (records.length > 0) {
                    // 按类别汇总价值
                    const categoryTotals = records.reduce((acc, curr) => {
                        acc[curr.category] = (acc[curr.category] || 0) + curr.value;
                        return acc;
                    }, {});
                    // 排序找最大
                    topCategory = Object.keys(categoryTotals).sort((a, b) => categoryTotals[b] - categoryTotals[a])[0];
                }

                // 2. 根据类别获取特定语料
                const praiseList = CATEGORY_PRAISE[topCategory] || CATEGORY_PRAISE.default;
                const randomPraise = praiseList[Math.floor(Math.random() * praiseList.length)];

                const avgHourlyRate = totalHours > 0 ? (totalAsset / totalHours).toFixed(0) : 0;

                // 获取类别中文名，如果是 default 则显示"综合付出"
                const topCategoryLabel = MARKET_RATES[topCategory] ? MARKET_RATES[topCategory].label : "综合家务";

                setReportContent({
                    totalValue: totalAsset.toFixed(0),
                    totalHours: totalHours.toFixed(1),
                    avgRate: avgHourlyRate,
                    praise: randomPraise,
                    date: new Date().toLocaleDateString(),
                    dominantType: topCategoryLabel
                });
                setShowReport(true);
            };

            const formatDuration = (mins) => {
                const h = Math.floor(mins / 60);
                const m = mins % 60;
                if (h > 0 && m > 0) return `${h}小时 ${m}分钟`;
                if (h > 0) return `${h}小时`;
                return `${m}分钟`;
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans relative overflow-hidden select-none">

                    {/* 顶部导航 */}
                    <div className="bg-white shadow-sm sticky top-0 z-10 px-4 py-3 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className="bg-indigo-600 p-1.5 rounded-lg">
                                <TrendingUp className="w-5 h-5 text-white" />
                            </div>
                            <h1 className="text-lg font-bold text-slate-900 tracking-tight">家务审计系统</h1>
                        </div>
                        <button
                            onClick={generateReport}
                            className="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 border border-indigo-200 text-sm px-4 py-2 rounded-full font-medium transition-all shadow-sm active:scale-95 flex items-center gap-2"
                        >
                            <Sparkles className="w-4 h-4 text-indigo-500" />
                            生成家务价值报告
                        </button>
                    </div>

                    <div className="p-4 max-w-md mx-auto space-y-6 pb-24">

                        {/* 资产卡片 */}
                        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-6 text-white shadow-xl shadow-indigo-200 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-10">
                                <Wallet size={120} />
                            </div>
                            <div className="relative z-10">
                                <p className="text-indigo-100 text-sm font-medium mb-1 flex items-center gap-1">
                                    累计劳动资产 (Labor Assets)
                                    <span className="bg-white/20 text-white text-[10px] px-1.5 py-0.5 rounded ml-2 backdrop-blur-sm">北京基准</span>
                                </p>
                                <div className={`text-5xl font-bold tracking-tight mb-4 transition-transform ${isAnimating ? 'scale-110' : ''}`}>
                                    ¥{totalAsset.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                </div>
                                <div className="flex gap-4 text-sm text-indigo-100">
                                    <div className="bg-white/10 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-white/10">
                                        <span className="block text-xs text-indigo-200">累计工时</span>
                                        <span className="font-semibold text-white">{totalHours.toFixed(1)}h</span>
                                    </div>
                                    <div className="bg-white/10 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-white/10">
                                        <span className="block text-xs text-indigo-200">贡献笔数</span>
                                        <span className="font-semibold text-white">{records.length}笔</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 类别选择 */}
                        <div>
                            <h3 className="text-sm font-bold text-slate-500 mb-3 uppercase tracking-wider">选择劳动类别</h3>
                            <div className="grid grid-cols-3 gap-3">
                                {Object.entries(MARKET_RATES).map(([key, data]) => {
                                    const Icon = data.icon;
                                    const isSelected = selectedCategory === key;
                                    return (
                                        <button
                                            key={key}
                                            onClick={() => setSelectedCategory(key)}
                                            className={`
                                                relative p-3 rounded-xl flex flex-col items-center justify-center gap-2 transition-all border-2
                                                ${isSelected
                                                    ? 'border-indigo-500 bg-white shadow-md scale-105 z-10'
                                                    : 'border-transparent bg-white shadow-sm hover:bg-slate-50'
                                                }
                                            `}
                                        >
                                            <div className={`p-2 rounded-full ${data.color}`}>
                                                <Icon className="w-6 h-6" />
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-sm text-slate-700">{data.label}</div>
                                                <div className="text-[10px] text-slate-400">¥{data.rate}/时</div>
                                            </div>
                                            {isSelected && (
                                                <div className="absolute top-2 right-2 w-2 h-2 bg-indigo-500 rounded-full animate-pulse" />
                                            )}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 时间选择 */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider">投入时长</h3>
                                <span className="text-2xl font-bold text-indigo-600">{formatDuration(duration)}</span>
                            </div>

                            <input
                                type="range"
                                min="15"
                                max="480"
                                step="15"
                                value={duration}
                                onChange={(e) => setDuration(parseInt(e.target.value))}
                                className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                            />
                            <div className="flex justify-between text-xs text-slate-400 mt-3">
                                <span>15分钟</span>
                                <span>2小时</span>
                                <span>4小时</span>
                                <span>8小时</span>
                            </div>
                        </div>

                        {/* 记账按钮 */}
                        <button
                            onClick={handleAddRecord}
                            className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-indigo-200 transform transition active:scale-95 flex items-center justify-center gap-2"
                        >
                            <Plus className="w-6 h-6" />
                            记入家庭账本 (+¥{(MARKET_RATES[selectedCategory].rate * duration / 60).toFixed(0)})
                        </button>

                        {/* 历史记录 */}
                        <div className="pt-2">
                            <h3 className="text-sm font-bold text-slate-500 mb-3 uppercase tracking-wider flex items-center gap-2">
                                <History className="w-4 h-4" /> 近期审计记录
                            </h3>
                            <div className="space-y-3">
                                {records.slice(0, 5).map((record) => {
                                    const Icon = MARKET_RATES[record.category]?.icon || Sparkles;
                                    return (
                                        <div key={record.id} className="bg-white p-3 rounded-xl flex items-center justify-between shadow-sm border border-slate-50">
                                            <div className="flex items-center gap-3">
                                                <div className={`p-2 rounded-full bg-slate-50 text-slate-500`}>
                                                    <Icon className="w-5 h-5" />
                                                </div>
                                                <div>
                                                    <div className="font-bold text-sm text-slate-800">{MARKET_RATES[record.category]?.label}</div>
                                                    <div className="text-xs text-slate-400">{new Date(record.date).toLocaleDateString()} · {formatDuration(record.duration)}</div>
                                                </div>
                                            </div>
                                            <div className="font-bold text-green-600">+¥{record.value.toFixed(0)}</div>
                                        </div>
                                    );
                                })}
                                {records.length === 0 && (
                                    <div className="text-center py-8 text-slate-400 text-sm italic">
                                        暂无记录，快去记录你的第一次付出吧！
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>

                    {/* 报告弹窗 */}
                    {showReport && reportContent && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in">
                            <div className="bg-white w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl animate-in">
                                <div className="bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-center text-white relative">
                                    <button
                                        onClick={() => setShowReport(false)}
                                        className="absolute top-4 right-4 text-white/70 hover:text-white"
                                    >
                                        <X className="w-6 h-6" />
                                    </button>
                                    <div className="inline-block p-3 bg-white/20 rounded-full mb-3">
                                        <FileText className="w-8 h-8 text-white" />
                                    </div>
                                    <h2 className="text-2xl font-bold">家庭劳动价值报告</h2>
                                    <div className="inline-block px-2 py-0.5 mt-2 bg-white/20 rounded text-xs font-medium border border-white/20">
                                        主要贡献：{reportContent.dominantType}
                                    </div>
                                </div>

                                <div className="p-6">
                                    <div className="grid grid-cols-2 gap-4 mb-6">
                                        <div className="bg-slate-50 p-4 rounded-xl text-center border border-slate-100">
                                            <div className="text-xs text-slate-500 mb-1">审计总估值</div>
                                            <div className="text-xl font-bold text-indigo-600">¥{reportContent.totalValue}</div>
                                        </div>
                                        <div className="bg-slate-50 p-4 rounded-xl text-center border border-slate-100">
                                            <div className="text-xs text-slate-500 mb-1">贡献时长</div>
                                            <div className="text-xl font-bold text-slate-800">{reportContent.totalHours}h</div>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2">
                                            <Sparkles className="w-4 h-4 text-amber-500" />
                                            AI 情感审计意见
                                        </h4>
                                        <div className="bg-indigo-50 p-5 rounded-xl text-sm text-indigo-900 leading-relaxed text-justify border border-indigo-100 relative shadow-inner">
                                            <span className="text-5xl text-indigo-200/50 absolute -top-3 -left-2 font-serif">“</span>
                                            <div className="relative z-10 text-slate-700 font-medium">
                                                {reportContent.praise}
                                            </div>
                                            <span className="text-5xl text-indigo-200/50 absolute -bottom-8 right-0 font-serif">”</span>
                                        </div>
                                    </div>

                                    <div className="text-center text-xs text-slate-400 mb-6">
                                        * 估值基于当前市场参考价，情感价值无价
                                    </div>

                                    <button
                                        onClick={() => {
                                           alert("已生成精美海报，正在唤起分享...");
                                        }}
                                        className="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-lg"
                                    >
                                        <Share2 className="w-4 h-4" />
                                        分享给家庭成员
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FamilyLaborAudit />);
    </script>
</body>
</html>
